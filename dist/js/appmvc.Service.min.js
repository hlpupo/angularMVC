angular.module("appmvc.Services").factory("todoStorage",function(o,t){"use strict";return o.get("/api").then(function(){return t.get("api")},function(){return t.get("localStorage")})}).factory("api",function(o){"use strict";var t={todos:[],clearCompleted:function(){var e=t.todos.slice(0),r=[],n=[];return t.todos.forEach(function(o){o.completed?r.push(o):n.push(o)}),angular.copy(n,t.todos),o.delete("/api/todos").then(function(){return t.todos},function(){return angular.copy(e,t.todos),e})},delete:function(e){var r=t.todos.slice(0);return t.todos.splice(t.todos.indexOf(e),1),o.delete("/api/todos/"+e.id).then(function(){return t.todos},function(){return angular.copy(r,t.todos),r})},get:function(){return o.get("/api/todos").then(function(o){return angular.copy(o.data,t.todos),t.todos})},insert:function(e){var r=t.todos.slice(0);return o.post("/api/todos",e).then(function(o){return e.id=o.data.id,t.todos.push(e),t.todos},function(){return angular.copy(r,t.todos),t.todos})},put:function(e){var r=t.todos.slice(0);return o.put("/api/todos/"+e.id,e).then(function(){return t.todos},function(){return angular.copy(r,t.todos),r})}};return t}).factory("localStorage",function(o){"use strict";var t="todos-angularjs",e={todos:[],_getFromLocalStorage:function(){return JSON.parse(localStorage.getItem(t)||"[]")},_saveToLocalStorage:function(o){localStorage.setItem(t,JSON.stringify(o))},clearCompleted:function(){var t=o.defer(),r=[],n=[];return e.todos.forEach(function(o){o.completed?r.push(o):n.push(o)}),angular.copy(n,e.todos),e._saveToLocalStorage(e.todos),t.resolve(e.todos),t.promise},delete:function(t){var r=o.defer();return e.todos.splice(e.todos.indexOf(t),1),e._saveToLocalStorage(e.todos),r.resolve(e.todos),r.promise},get:function(){var t=o.defer();return angular.copy(e._getFromLocalStorage(),e.todos),t.resolve(e.todos),t.promise},insert:function(t){var r=o.defer();return e.todos.push(t),e._saveToLocalStorage(e.todos),r.resolve(e.todos),r.promise},put:function(t,r){var n=o.defer();return e.todos[r]=t,e._saveToLocalStorage(e.todos),n.resolve(e.todos),n.promise}};return e});